<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.0.xsd">

  <changeSet id="01_fix_ProviderEvent_type" author="Pavel_Bobylev@epam.com">
    <update tableName="type_lookup">
      <column name="type_uri" value="http://bibfra.me/vocab/lite/ProviderEvent"/>
      <where>type_uri='https://bibfra.me/vocab/lite/ProviderEvent'</where>
    </update>
  </changeSet>

  <changeSet id="02_delete_resources_data" author="Pavel_Bobylev@epam.com">
    <delete tableName="resource_edges"/>
    <delete tableName="resources"/>
  </changeSet>

  <changeSet id="03_delete_duplicated_types" author="Pavel_Bobylev@epam.com">
    <delete tableName="type_lookup">
      <where>
        type_hash in (5979038995, 706694777, 1374340632, 1114310900)
      </where>
    </delete>
  </changeSet>

  <changeSet id="04_add_type_uri_unique_constraint" author="Pavel_Bobylev@epam.com">
    <addUniqueConstraint tableName="type_lookup" columnNames="type_uri" constraintName="unique_type_uri"/>
  </changeSet>

  <changeSet id="05_update_type_hashes" author="Pavel_Bobylev@epam.com">
    <update tableName="type_lookup">
      <column name="type_hash" valueComputed="hashing.hash_text(type_uri)"/>
    </update>
  </changeSet>

  <changeSet id="06_add_predicate_unique_constraint" author="Pavel_Bobylev@epam.com">
    <addUniqueConstraint tableName="predicate_lookup" columnNames="predicate" constraintName="unique_predicate"/>
  </changeSet>

  <changeSet id="07_update_predicate_hashes" author="Pavel_Bobylev@epam.com">
    <update tableName="predicate_lookup">
      <column name="predicate_hash" valueComputed="hashing.hash_text(predicate)"/>
    </update>
  </changeSet>

  <changeSet id="08_update_map_predicate" author="Pavel_Bobylev@epam.com">
    <update tableName="predicate_lookup">
      <column name="predicate" value="http://library.link/vocab/map"/>
      <column name="predicate_hash" valueComputed="hashing.hash_text('http://library.link/vocab/map')"/>
      <where>predicate = 'http://bibfra.me/vocab/lite/map'</where>
    </update>
  </changeSet>

  <changeSet id="09_insert_category_and_copyright_types" author="Pavel_Bobylev@epam.com">
    <insert tableName="type_lookup">
      <column name="type_uri" value="http://bibfra.me/vocab/lite/Category"/>
      <column name="type_hash" valueComputed="hashing.hash_text('http://bibfra.me/vocab/lite/Category')"/>
    </insert>
    <insert tableName="type_lookup">
      <column name="type_uri" value="http://bibfra.me/vocab/lite/CopyrightEvent"/>
      <column name="type_hash" valueComputed="hashing.hash_text('http://bibfra.me/vocab/lite/CopyrightEvent')"/>
    </insert>
  </changeSet>

  <changeSet id="10_insert_copyright_and_provider_place_predicates" author="Pavel_Bobylev@epam.com">
    <insert tableName="predicate_lookup">
      <column name="predicate" value="http://bibfra.me/vocab/marc/copyright"/>
      <column name="predicate_hash" valueComputed="hashing.hash_text('http://bibfra.me/vocab/marc/copyright')"/>
    </insert>
    <insert tableName="predicate_lookup">
      <column name="predicate" value="http://bibfra.me/vocab/lite/providerPlace"/>
      <column name="predicate_hash" valueComputed="hashing.hash_text('http://bibfra.me/vocab/lite/providerPlace')"/>
    </insert>
  </changeSet>

  <changeSet id="11_fix_annotation_type" author="Pavel_Bobylev@epam.com">
    <preConditions>
      <sqlCheck expectedResult="0">
        select count(*) from type_lookup tl where tl.type_uri = 'http://bibfra.me/vocab/lite/Annotation'
      </sqlCheck>
    </preConditions>
    <update tableName="type_lookup">
      <column name="type_uri" value="http://bibfra.me/vocab/lite/Annotation"/>
      <column name="type_hash" valueComputed="hashing.hash_text('http://bibfra.me/vocab/lite/Annotation')"/>
      <where>type_uri='http://bibfra.me/vocab/marc/AccessLocation'</where>
    </update>
  </changeSet>


</databaseChangeLog>
